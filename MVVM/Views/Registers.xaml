<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ACS_View.MVVM.ViewModels"
             xmlns:local="clr-namespace:ACS_View.MVVM.Models"
             x:Class="ACS_View.MVVM.Views.Registers"
             NavigationPage.HasNavigationBar="False"
             Background="#E6EBED">

    <ContentPage.BindingContext>
        <vm:RegistersViewModel/>
    </ContentPage.BindingContext>

    <ContentPage.Resources>
        <Style x:Key="buttons" TargetType="Button">
            <Setter Property="BackgroundColor" Value="#0084B1"/>
            <Setter Property="TextColor" Value="White"/>
            <Setter Property="FontAttributes" Value="Bold"/>
            <Setter Property="FontSize" Value="20"/>
            <Setter Property="CornerRadius" Value="15"/>
            <Setter Property="Margin" Value="20,10,20,0"/>
            <Setter Property="MaximumHeightRequest" Value="60"/>
        </Style>
        <Style x:Key="Lbl_Datas" TargetType="Label">
            <Setter Property="HorizontalOptions" Value="Start"/>
            <Setter Property="Margin" Value="5,0,0,0"/>
            <Setter Property="TextColor" Value="Black"/>
            <Setter Property="Opacity" Value="0.7"/>
        </Style>

        <ResourceDictionary>
            <local:SUSFormatConverter x:Key="SUSFormatConverter" />
        </ResourceDictionary>
    </ContentPage.Resources>

    <Grid RowDefinitions="auto,*,auto">

        <VerticalStackLayout
            Grid.Row="0"
            VerticalOptions="Start">

            <Label
                x:Name="Lbl_Title"
                TextColor="#0084B1"
                Text="Cadastros"
                Margin="30,15"
                FontSize="30"
                FontAttributes="Bold" 
                HorizontalOptions="Center"
                LineBreakMode="WordWrap"
                VerticalTextAlignment="Center"
                HorizontalTextAlignment="Center"/>

            <Border
                Margin="10,15"
                Stroke="Grey"
                StrokeThickness="2"
                StrokeShape="RoundRectangle 10"
                Padding="0"
                BackgroundColor="White">

                <VerticalStackLayout>

                    <Grid ColumnDefinitions="auto">

                        <SearchBar
                            Grid.Column="0"
                            x:Name="SB"
                            Placeholder="Pesquisar"
                            TextColor="#0084B1"
                            FontSize="20"
                            MaxLength="30"
                            IsSpellCheckEnabled="True"
                            BackgroundColor="White"
                            TextChanged="SB_TextChanged"/>

                        <Image
                            Grid.Column="0"
                            HorizontalOptions="Start"
                            Source="loupe.png"
                            HeightRequest="21"
                            WidthRequest="21"
                            Margin="21,0,0,0"/>
                    </Grid>

                    <Grid
                        RowDefinitions="auto,*"
                        ColumnDefinitions="*,*">

                        <BoxView
                            Grid.Row="0"
                            Grid.ColumnSpan="3"
                            Color="Grey"
                            HeightRequest="2"/>

                        <Button
                            Grid.Column="0"
                            Grid.Row="1"
                            x:Name="Btn_filter"
                            Style="{StaticResource buttons}"
                            Margin="0"
                            Padding="5"
                            FontAttributes="None"
                            BorderWidth="0"
                            CornerRadius="0"
                            MaximumHeightRequest="40"
                            FontSize="15"
                            FontAutoScalingEnabled="True"
                            Text="Ordenar por Nome"
                            Clicked="Btn_filter_Clicked"/>

                        <Button
                            Grid.Row="1"
                            Grid.Column="1"
                            x:Name="Btn_order"
                            Style="{StaticResource buttons}"
                            Margin="0"
                            FontAttributes="None"
                            Padding="5"
                            BorderWidth="0"
                            CornerRadius="0"
                            MaximumHeightRequest="40"
                            FontSize="15"
                            FontAutoScalingEnabled="True"
                            Text="Ordem Crescente"
                            Clicked="Btn_order_Clicked"/>

                    </Grid>

                </VerticalStackLayout>

            </Border>

        </VerticalStackLayout>

        <CollectionView
            Grid.Row="1"
            x:Name="collectionView"
            ItemsSource="{Binding Person}"
            SelectionMode="None"
            CanReorderItems="False"
            BackgroundColor="Transparent"
            CanMixGroups="False"
            Margin="10,0">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border
                        StrokeShape="RoundRectangle 10"
                        StrokeThickness="2"
                        Margin="0,10,0,0"
                        Stroke="Grey">

                        <Grid
                            RowDefinitions="*,*,*,*,*,*"
                            BackgroundColor="White"
                            Padding="5">

                            <Label
                                Grid.Row="0"
                                Text="{Binding Nome}"
                                FontAttributes="Bold"
                                FontSize="18"
                                LineBreakMode="CharacterWrap"
                                Style="{StaticResource Lbl_Datas}"/>

                            <HorizontalStackLayout
                                Grid.Row="2">

                                <Label
                                    Text="{Binding Nascimento, StringFormat='{0:dd/MM/yyyy}'}"
                                    FontAttributes="None"
                                    FontSize="16"
                                    Style="{StaticResource Lbl_Datas}"/>

                                <Label
                                    Text="-"
                                    FontAttributes="None"
                                    FontSize="16"
                                    Style="{StaticResource Lbl_Datas}"/>

                                <Label
                                    Text="{Binding Idade}"
                                    FontSize="16"
                                    Style="{StaticResource Lbl_Datas}"/>

                            </HorizontalStackLayout>

                            <Label
                                Grid.Row="1"
                                Text="{Binding Sus, Converter={StaticResource SUSFormatConverter}}"
                                FontSize="18"
                                LineBreakMode="NoWrap"
                                Style="{StaticResource Lbl_Datas}"/>

                            <Label
                                x:Name="Lbl_Obs"
                                Grid.Row="3"
                                FontSize="16"
                                Opacity="0.7"
                                FontAttributes="Italic"
                                TextColor="#C93919"
                                IsVisible="{Binding HasObs}"
                                Style="{StaticResource Lbl_Datas}"
                                Text="{Binding Observacao}"/>

                            <Label
                                Grid.Row="4"
                                Text="{Binding Endereco}"
                                LineBreakMode="WordWrap"
                                FontSize="16"
                                Style="{StaticResource Lbl_Datas}"/>

                            <Grid
                                Grid.Row="5"
                                ColumnDefinitions="*,*"
                                HorizontalOptions="Fill"
                                VerticalOptions="Center"
                                ColumnSpacing="10"
                                Margin="5,5,5,5">
                                
                                <Button
                                    Grid.Column="0"
                                    x:Name="Btn_Edit"
                                    ImageSource="pencil.png"
                                    MaximumHeightRequest="35"
                                    Text="Editar"
                                    TextColor="DarkOrange"
                                    FontSize="14"
                                    BackgroundColor="AliceBlue"
                                    BorderColor="Grey"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.EditCommand}"
                                    CommandParameter="{Binding Sus}"/>

                                <Button
                                    Grid.Column="1"
                                    x:Name="Btn_Delete"
                                    ImageSource="bin.png"
                                    MaximumHeightRequest="35"
                                    Text="Excluir"
                                    TextColor="#C93919"
                                    FontSize="14"
                                    BackgroundColor="AliceBlue"
                                    BorderColor="#C93919"
                                    Command="{Binding Source={RelativeSource AncestorType={x:Type ContentPage}}, Path=BindingContext.DeleteCommand}"
                                    CommandParameter="{Binding Sus}"/>
                            </Grid>
                        </Grid>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>

        </CollectionView>

        <VerticalStackLayout Grid.Row="2" VerticalOptions="End" Margin="0,20">

            <Button
                x:Name="Btn_AddRegister"
                Style="{StaticResource buttons}"
                Text="Adicionar Cadastro"
                Clicked="Btn_AddRegister_Clicked"/>

            <Button
                x:Name="Btn_RegistersGoBack"
                Style="{StaticResource buttons}"
                Text="Voltar"
                Clicked="Btn_RegistersGoBack_Clicked"/>

        </VerticalStackLayout>
    </Grid>
</ContentPage>