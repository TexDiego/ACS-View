<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:vm="clr-namespace:ACS_View.MVVM.ViewModels"
             xmlns:model="clr-namespace:ACS_View.MVVM.Models"
             x:DataType="vm:HousesPageViewModel"
             x:Class="ACS_View.MVVM.Views.HousesPage"
             Shell.NavBarIsVisible="True"
             Title="Residências"
             Background="#E6EBED">

    <ContentPage.ToolbarItems>
        <ToolbarItem
            IconImageSource="addhouse.png"
            Command="{Binding NewHouseCommand}"/>
    </ContentPage.ToolbarItems>

    <Grid Margin="10,0,10,10" Padding="0">

        <!-- Barra de pesquisa -->
        <Border
            VerticalOptions="Start"
            Margin="-12,-1"
            StrokeThickness="2"
            Stroke="Gray">

            <SearchBar
                Placeholder="Buscar..."
                PlaceholderColor="Black"                       
                Text="{Binding SearchText, Mode=TwoWay}"
                FontSize="16"
                CancelButtonColor="Gray"
                TextColor="Black"
                BackgroundColor="White"
                MaxLength="30"
                VerticalOptions="Center"
                TextChanged="SearchBar_TextChanged"/>

        </Border>

        <!-- Lista de residências -->
        <CollectionView
            VerticalOptions="Start"
            Margin="0,55,0,0"
            ItemsSource="{Binding Houses}"
            SelectionMode="None">

            <CollectionView.ItemTemplate>
                <DataTemplate>
                    <Border
                        Margin="0,5"
                        x:DataType="model:House"
                        Stroke="Gray"
                        BackgroundColor="White"
                        StrokeShape="RoundRectangle 8">

                        <SwipeView>

                            <SwipeView.LeftItems>
                                <SwipeItem
                                        IconImageSource="bin.png"
                                        Text="Excluir"
                                        BackgroundColor="IndianRed"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HousesPageViewModel}}, Path=DeleteCommand}"
                                        CommandParameter="{Binding CasaId}"/>
                            </SwipeView.LeftItems>

                            <SwipeView.RightItems>
                                <SwipeItem
                                        IconImageSource="pencil.png"
                                        Text="Editar"
                                        BackgroundColor="DarkOrange"
                                        Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HousesPageViewModel}}, Path=EditCommand}"
                                        CommandParameter="{Binding CasaId}"/>
                            </SwipeView.RightItems>

                            <VerticalStackLayout
                                Padding="10"
                                BackgroundColor="White">

                                <VerticalStackLayout.GestureRecognizers>
                                    <TapGestureRecognizer
                                            Command="{Binding Source={RelativeSource AncestorType={x:Type vm:HousesPageViewModel}}, Path=FamilyCommand}"
                                            CommandParameter="{Binding CasaId}"/>
                                </VerticalStackLayout.GestureRecognizers>

                                <!-- Rua -->
                                <Label
                                    Text="{Binding Rua}"
                                    FontSize="18"
                                    Opacity="0.7"
                                    TextColor="Black"
                                    FontAttributes="Bold" />

                                <!-- Número e Complemento -->
                                <HorizontalStackLayout
                                        Margin="0,0,0,10">

                                    <Label Text="Número: " FontSize="14" TextColor="Black" Opacity="0.7"/>

                                    <Label Text="{Binding NumeroCasa}" FontSize="14" TextColor="Black" Opacity="0.7" Margin="0,0,5,0"/>

                                    <Label Text="{Binding Complemento}" FontSize="14" TextColor="Black" Opacity="0.7"/>

                                </HorizontalStackLayout>
                            </VerticalStackLayout>

                        </SwipeView>
                    </Border>
                </DataTemplate>
            </CollectionView.ItemTemplate>
        </CollectionView>

        <Border
            Grid.RowSpan="2"
            HorizontalOptions="Center"
            Padding="10,5"
            Margin="15"
            VerticalOptions="End"
            BackgroundColor="White"
            StrokeShape="RoundRectangle 15"
            StrokeThickness="1"
            Stroke="Gray">

            <Label
                Text="{Binding TotalHouses, StringFormat='{0} registros encontrados'}"
                TextColor="Black"
                FontSize="16"
                FontAttributes="Bold"/>

        </Border>
        
    </Grid>
    
</ContentPage>
